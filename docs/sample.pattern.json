{
  "$schema": "https://calm.finos.org/release/1.1/meta/calm.json",
  "$id": "https://example.com/patterns/business-system.pattern.json",
  "title": "Business System Pattern",
  "description": "A reusable pattern for a business system with user, application, and database components",
  "type": "object",
  "properties": {
    "nodes": {
      "type": "array",
      "minItems": 3,
      "maxItems": 3,
      "prefixItems": [
        {
          "$ref": "https://calm.finos.org/release/1.1/meta/core.json#/defs/node",
          "type": "object",
          "properties": {
            "unique-id": {
              "const": "ghcp-user"
            },
            "node-type": {
              "const": "actor"
            },
            "name": {
              "const": "The GHCP User"
            },
            "description": {
              "type": "string"
            },
            "interfaces": {
              "type": "array",
              "minItems": 1,
              "maxItems": 1,
              "prefixItems": [
                {
                  "type": "object",
                  "properties": {
                    "unique-id": {
                      "const": "user-interface"
                    },
                    "url": {
                      "type": "string",
                      "format": "uri"
                    }
                  },
                  "required": ["unique-id", "url"]
                }
              ]
            }
          },
          "required": ["description"]
        },
        {
          "$ref": "https://calm.finos.org/release/1.1/meta/core.json#/defs/node",
          "type": "object",
          "properties": {
            "unique-id": {
              "const": "the-application"
            },
            "node-type": {
              "const": "system"
            },
            "name": {
              "const": "The Application"
            },
            "description": {
              "type": "string"
            },
            "interfaces": {
              "type": "array",
              "minItems": 1,
              "maxItems": 1,
              "prefixItems": [
                {
                  "type": "object",
                  "properties": {
                    "unique-id": {
                      "const": "app-endpoint"
                    },
                    "url": {
                      "type": "string",
                      "format": "uri"
                    }
                  },
                  "required": ["unique-id", "url"]
                }
              ]
            }
          },
          "required": ["description"]
        },
        {
          "$ref": "https://calm.finos.org/release/1.1/meta/core.json#/defs/node",
          "type": "object",
          "properties": {
            "unique-id": {
              "const": "the-database"
            },
            "node-type": {
              "const": "database"
            },
            "name": {
              "const": "The Database"
            },
            "description": {
              "type": "string"
            },
            "interfaces": {
              "type": "array",
              "minItems": 1,
              "maxItems": 1,
              "prefixItems": [
                {
                  "type": "object",
                  "properties": {
                    "unique-id": {
                      "const": "db-port"
                    },
                    "port": {
                      "type": "integer",
                      "minimum": 1,
                      "maximum": 65535
                    }
                  },
                  "required": ["unique-id", "port"]
                }
              ]
            }
          },
          "required": ["description"]
        }
      ]
    },
    "relationships": {
      "type": "array",
      "minItems": 2,
      "maxItems": 2,
      "prefixItems": [
        {
          "$ref": "https://calm.finos.org/release/1.1/meta/core.json#/defs/relationship",
          "type": "object",
          "properties": {
            "unique-id": {
              "const": "user-to-app"
            },
            "description": {
              "type": "string"
            },
            "protocol": {
              "const": "HTTPS"
            },
            "relationship-type": {
              "const": {
                "connects": {
                  "source": {
                    "node": "ghcp-user",
                    "interface": "user-interface"
                  },
                  "destination": {
                    "node": "the-application",
                    "interface": "app-endpoint"
                  }
                }
              }
            }
          },
          "required": ["description"]
        },
        {
          "$ref": "https://calm.finos.org/release/1.1/meta/core.json#/defs/relationship",
          "type": "object",
          "properties": {
            "unique-id": {
              "const": "app-to-database"
            },
            "description": {
              "type": "string"
            },
            "protocol": {
              "const": "JDBC"
            },
            "relationship-type": {
              "const": {
                "connects": {
                  "source": {
                    "node": "the-application"
                  },
                  "destination": {
                    "node": "the-database",
                    "interface": "db-port"
                  }
                }
              }
            }
          },
          "required": ["description"]
        }
      ]
    }
  },
  "required": ["nodes", "relationships"]
}
